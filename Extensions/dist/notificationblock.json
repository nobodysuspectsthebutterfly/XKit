{"id":"notificationblock","script":"//* TITLE NotificationBlock **//\n//* VERSION 1.4.2 **//\n//* DESCRIPTION Blocks notifications from a post **//\n//* DEVELOPER new-xkit **//\n//* DETAILS One post got way too popular and now just annoying you? Click on the notification block icon on that post to hide the notifications from that post. If you have Go-To-Dash installed, you can click on a notification, then click View button on top-right corner to quickly go back to the post on your dashboard.  **//\n//* FRAME false **//\n//* BETA false **//\n\nXKit.extensions.notificationblock = new Object({\n\n\trunning: false,\n\tbutton_icon: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAAXNSR0IArs4c6QAAAblJREFUOBGdk0soRFEcxi9NKUpWVmxYYoGU51KWhI2NZmNPsZpoNrPRpBHWrCSPslRsp4jFZMpKVhaKkGcJ4/fduWc6d+bOFf/65vv+z3POPWccJ8RisVgaHISU+FIRn4dDcw+USyQSx3BvcT7MLxlG8RH4ArV2I4vs4L+ySNSO2zpoWLVdYOlxdA5ErZhPVvq8352KsJK/DnNnceQ4mC4eHHTM4pogf4HgG0jZyX/tjAE6bo09SDrCdofgAbDITT0pKCPemleubjPaYveiqGsidkhvs465DfQMGkAUGMsaAZ8bTXOSRvci0MPEV4D7jHTMS69wkmS3p8tRnEGzSlL7Au2DRrAMHO1sC3QArbYKylk9g24ZUkfBPTDPJINOqkk7WwfvcrDOPJX+eoPmyDwAM0iFGXLPEpWIO3hDToilvdx8QM0Eu71W3DyNJfRnQKEJ9UmwsD70qQl6XAWfSLvDKNIlrClQzljdLNxl1TyiZ+gfU8wUSOsIVxIBtknDNwP3rJx2OEg8ZWKFYQT1EUfAjUlarA8vG82TcwH303Pm+S4VhskjmYXawS7Qf8+YvcAUdS3gwyQN/wCrsHgfRS7nugAAAABJRU5ErkJggg==\",\n\tbutton_ok: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0FDNkNDNzYxNkVEMTFFM0E2RkFCMjhCQTdGQjEwOTAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0FDNkNDNzcxNkVEMTFFM0E2RkFCMjhCQTdGQjEwOTAiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3QUM2Q0M3NDE2RUQxMUUzQTZGQUIyOEJBN0ZCMTA5MCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3QUM2Q0M3NTE2RUQxMUUzQTZGQUIyOEJBN0ZCMTA5MCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhNHAxwAAAFhSURBVHjaYsxeqs2ABxwF4s9A7IFLwZSoK3A2CxZ5SyD+D8QngNiKgQSAzbA9QPwXiPnQxFcD8VcgTiDFMC4cakOgLsZpGBMDaYARnySphsFAAxAXEONNYkAdEH8D4gnUcBnIu9zYvOkOxC1YYk8Hia2LK6JylukoAfFdmDdXQQ2SQYupy0jsS0jsHqSI8AfiyTCHgFx2ByoRB8QWRAR8CZT9BYg3ALEsEE+EuWwFEBtBbZuCxyAxIH4NxAJA/A7JdRegrgW7bD4Qf4dKGOMxDGRQKRC/R0tvF4D58zPMsDdAvICA945C6VoscpHACHiCnDT6gPgPHsOsoTQooE+jybED8Ulkw0CRMJWA62BqTZHEPgBxIdCbweiJFuSFezgMWgbE/4B4LZIYyIWuQIMmYMsBoEAMAOIXWAwrhdJBUPoaENsA8Rl82QmUUA2BeA0078EAsgWpQAwqnn+h2wgQYAAh60jncAp2xAAAAABJRU5ErkJggg==\",\n\tblacklisted: [],\n\n\tpreferences: {\n\n\t\task: {\n\t\t\ttext: \"Show the confirmation window\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\n\t},\n\n\trun: async function() {\n\n\t\tthis.running = true;\n\n\t\tif (XKit.interface.where().inbox === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait XKit.css_map.getCssMap();\n\t\tXKit.tools.init_css(\"notificationblock\");\n\n\t\tvar storage = XKit.storage.get_all(\"notificationblock\");\n\t\tif (storage && storage.posts) {\n\t\t\tthis.blacklisted = storage.posts.value.split(\",\").filter(i => i);\n\t\t}\n\n\t\tXKit.interface.react.create_control_button(\"xnotificationblockbutton\",\n\t\t\tthis.button_icon, \"NotificationBlock\",\n\t\t\tthis.on_click.bind(this), this.button_ok\n\t\t);\n\n\t\tXKit.post_listener.add(\"notificationblock\", this.do.bind(this));\n\t\tthis.do();\n\n\t\tif (XKit.interface.where().activity === true) {\n\t\t\tconsole.log(\"In activity, repeat block mode\");\n\t\t\tsetInterval(this.do.bind(this), 1000);\n\t\t}\n\n\t},\n\n\trecheck_all: function() {\n\t\tconst notificationClasses = [\n\t\t\t\"notification\",\n\t\t\t...XKit.css_map.keyToClasses('notification'),\n\t\t];\n\n\t\t$(notificationClasses.map(cls => `.${cls}.xnotificationblockchecked`).join(\", \")).\n\t\t\tremoveClass(\"xnotificationblockchecked\").removeAttr('data-xkit-notificationblock-blocked');\n\n\t\tthis.do();\n\t},\n\n\tunblock: function(post_id) {\n\t\tvar m_index = this.blacklisted.indexOf(post_id);\n\t\tif (m_index !== -1) {\n\t\t\tthis.blacklisted.splice(m_index, 1);\n\t\t\tXKit.storage.set(\"notificationblock\", \"posts\", this.blacklisted.join(\",\"));\n\t\t}\n\n\t\tthis.recheck_all();\n\t},\n\n\tblock: function(post_id) {\n\t\tif (this.blacklisted.indexOf(post_id) === -1) {\n\t\t\tthis.blacklisted.push(post_id);\n\t\t\tXKit.storage.set(\"notificationblock\", \"posts\", this.blacklisted.join(\",\"));\n\t\t}\n\n\t\tthis.recheck_all();\n\n\t},\n\n\ton_click: function(e) {\n\t\tconst self = this;\n\t\tconst $block_button = $(e.target || e.srcElement);\n\t\tconst post_id = $block_button.attr('data-post-id');\n\n\t\tif (this.preferences.ask.value === false) {\n\t\t\tif ($block_button.hasClass(\"xkit-interface-completed\")) {\n\t\t\t\tthis.unblock(post_id);\n\t\t\t\tXKit.interface.completed_control_button($block_button, false);\n\t\t\t} else {\n\t\t\t\tthis.block(post_id);\n\t\t\t\tXKit.interface.completed_control_button($block_button, true);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ($block_button.hasClass(\"xkit-interface-completed\")) {\n\t\t\tXKit.window.show(\"Unblock notifications from this post?\",\n\t\t\t\t\"Notifications from this post will be shown. You may have to refresh the page for changes to take effect\",\n\t\t\t\t\"question\",\n\t\t\t\t'<div class=\"xkit-button default\" id=\"xkit-notification-block-ok\">Unblock Notifications</div><div class=\"xkit-button\" id=\"xkit-close-message\">Cancel</div>');\n\n\t\t\t$(\"#xkit-notification-block-ok\").click(function() {\n\t\t\t\tself.unblock(post_id);\n\t\t\t\tXKit.window.close();\n\t\t\t\tXKit.interface.completed_control_button($block_button, false);\n\t\t\t});\n\n\t\t} else {\n\t\t\tXKit.window.show(\"Block notifications from this post?\",\n\t\t\t\t\"Notifications originating from this post will be blocked on the dashboard and activity page, without any indication that they were blocked.\",\n\t\t\t\t\"question\",\n\t\t\t\t'<div class=\"xkit-button default\" id=\"xkit-notification-block-ok\">Block Notifications</div><div class=\"xkit-button\" id=\"xkit-close-message\">Cancel</div>');\n\n\t\t\t$(\"#xkit-notification-block-ok\").click(function() {\n\t\t\t\tself.block(post_id);\n\t\t\t\tXKit.window.close();\n\t\t\t\tXKit.interface.completed_control_button($block_button, true);\n\t\t\t});\n\t\t}\n\t},\n\n\tpopulate_notification_props: function() {\n\t\treturn XKit.tools.async_add_function(async () => {\n\t\t\t/* globals tumblr */\n\n\t\t\tconst keyStartsWith = (obj, prefix) =>\n\t\t\t\tObject.keys(obj).find(key => key.startsWith(prefix));\n\n\t\t\tconst cssMap = await tumblr.getCssMap();\n\t\t\tconst elements = document.querySelectorAll(\n\t\t\t\tcssMap.notification.map(cls => `.${cls}:not([data-target-id])`).join(',')\n\t\t\t);\n\n\t\t\telements.forEach(element => {\n\t\t\t\tlet fiber = element[keyStartsWith(element, '__reactFiber')];\n\t\t\t\tconst notificationProp = () => fiber.memoizedProps && fiber.memoizedProps.notification;\n\n\t\t\t\twhile (fiber && !notificationProp()) {\n\t\t\t\t\tfiber = fiber.return;\n\t\t\t\t}\n\n\t\t\t\tif (fiber) {\n\t\t\t\t\tconst {targetPostId} = notificationProp();\n\t\t\t\t\telement.dataset.targetId = targetPostId;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tdo: async function() {\n\t\tconst self = this;\n\n\t\tif (self.blacklisted.some(i => i)) {\n\t\t\tconst blacklisted_post_regexp = new RegExp(`\\\\b(${self.blacklisted.join('|')})\\\\b`);\n\n\t\t\tawait self.populate_notification_props();\n\n\t\t\t$(`.notification, ${XKit.css_map.keyToCss('notification')}`).\n\t\t\t\tnot(\".xnotificationblockchecked\").\n\t\t\t\teach(function() {\n\t\t\t\t\tconst $note = $(this);\n\n\t\t\t\t\t$note.addClass(\"xnotificationblockchecked\");\n\n\t\t\t\t\tlet target_url = $note.children('a').attr('href') || $note.find(\".notification_target\").attr('href');\n\n\t\t\t\t\tif ($note.attr('data-target-id')) {\n\t\t\t\t\t\ttarget_url = target_url + \" \" + $note.attr('data-target-id');\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($note.attr('data-url-original')) {\n\t\t\t\t\t\ttarget_url = target_url + \" \" +\t$note.attr('data-url-original');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (blacklisted_post_regexp.test(target_url)) {\n\t\t\t\t\t\tconsole.log(`Blocking ${target_url} with regex ${blacklisted_post_regexp}`);\n\t\t\t\t\t\tthis.dataset.xkitNotificationblockBlocked = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\n\t\t$(\".xkit-old-notifications, .notification\").first().addClass(\"first_notification\");\n\t\t$(\".xkit-old-notifications, .notification\").first().each(function() {\n\t\t\tif ($(this).is(\":last\")) {\n\t\t\t\t$(this).removeClass(\"first_notification\").addClass(\"single_notification\");\n\t\t\t}\n\t\t});\n\n\t\tif ($(\"[data-id]\").length > 0) {\n\t\t\tconst posts = await XKit.interface.react.get_posts(\"xnotificationblockchecked\", !!'can_edit');\n\t\t\t$(posts).each(async function() {\n\t\t\t\t$(this).addClass(\"xnotificationblockchecked\");\n\t\t\t\tvar post_id = this.dataset.id;\n\n\t\t\t\tawait XKit.interface.react.add_control_button($(this), \"xnotificationblockbutton\");\n\n\t\t\t\tif (XKit.extensions.notificationblock.blacklisted.indexOf(post_id) !== -1) {\n\t\t\t\t\tXKit.interface.completed_control_button(\n\t\t\t\t\t\t$(this).find(\".xnotificationblockbutton div\"), true\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t},\n\n\tdestroy: function() {\n\t\tthis.running = false;\n\t\tXKit.post_listener.remove(\"notificationblock\");\n\t\t$(\".xnotificationblockbutton\").remove();\n\t\t$(\".xnotificationblockchecked\").removeClass(\"xnotificationblockchecked\");\n\t\t$(\".xkit-notification-notification-block-button\").remove();\n\t\tXKit.tools.remove_css(\"notificationblock_notfix\");\n\t}\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGNzdGMTE3NDA3MjA2ODExODA4MzkyMjM2MzU5MTQ4NCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1NTY1ODZDODM4QzQxMUUzQTFDQUFDOThEMTlDRUY3OSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1NTY1ODZDNzM4QzQxMUUzQTFDQUFDOThEMTlDRUY3OSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZCN0YxMTc0MDcyMDY4MTE4MDgzOTIyMzYzNTkxNDg0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY3N0YxMTc0MDcyMDY4MTE4MDgzOTIyMzYzNTkxNDg0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+lGIJ0gAAAmpJREFUeNpi/Kpkw0BLwMRAYzBqAUHAwsDIRGsLGIlUyr5s2v8v336llVDZB0yaOgwM//9dv8psqgXk/iLRx4R9wLGim+Hv32/GvlA+IyNbb8P/bz9+13YQaQEzASWc7GBzYcoYmVl8bBn+//9d103VSIYrgzCA/iZOIwsDE3EWwJUhMVjTYv99+vJ3xXp8FjASZwFcGTKDNS+C4fvP76s24vUBMzNRPoArQ2YAA4qLA78JTCAvYyAmcxOWzDgGbl54gDAqKkIZSkrIYfXdIgLIYJSSYt88C6tR2COZvbeEgYeTUULkd9MkaGJdPwHKWNcP9Xte0nfjYJBFtpaslUlM3FxYjQIGERbRf49eMGkpsvjZ/Vm3C6vHf89Y82feSqBezoNLIOn498y1WI0CWsCCKfp39wmgBaA8VZ6CKfvdPZ3h0ycGPj7O3XMg+fTfzYd/Vm7FahQwmJgx0Z8dhxh+/gJJaylicf+XryxR/px75sJLgX+3H4HUYzOKiYGFGQv69u3P1qNYA+ffpdtABazJASjh4GbJvmEyVqOwpyIg+rNmB8Pff1i8rKcKlP3unfnv+n2EKBvLv2v3caQiHKn4/6u3v9fvZw1xxiLHysLw7z+TJiz0vnz7vXDLn/W7sBqFL6P9WbKJ2VqfSVIERXDfaWByZG3IhIbYjQe/Ji//f+cBLnOYGFmYcaLfv383zfz/7hNKApu3DijFYmMAMv3h81/lfQwPHuMxhAUUFbjB/2cvfhZ0saaHMptoMrCzgUQ+f4Vo+T15xd894ISA1wTG7wH5NK6TWZiHugXMNPcBy1D3ASttfQAQYADCE7PREUA/jAAAAABJRU5ErkJggg==","css":".xkit-notification-notification-block-button {\n\tposition: absolute;\n\tright: 35px; top: 7px;\n\tbackground: rgba(255,255,255,.38) !important;\n\tdisplay: none;\n\tcolor: #3d546b !important;\n\tfont-weight: bold;\n\tfont-size: 9px !important;\n\tpadding: 0px 2px; border-radius: 2px;\n\ttext-decoration: none;\n\ttext-transform: uppercase !important;\n\tline-height: 12px !important; height: 12px !important;\n}\n\n[data-xkit-notificationblock-blocked] {\n\tdisplay: none;\n}\n\n.notification:hover .xkit-notification-notification-block-button {\n\tdisplay: block;\n}\n\n.xkit-notification-notification-block-button:hover {\n\tbackground-color: rgba(255,255,255,.75) !important;\n}\n","title":"NotificationBlock","description":"Blocks notifications from a post","developer":"new-xkit","version":"1.4.2","details":"One post got way too popular and now just annoying you? Click on the notification block icon on that post to hide the notifications from that post. If you have Go-To-Dash installed, you can click on a notification, then click View button on top-right corner to quickly go back to the post on your dashboard.","frame":"false","beta":"false","slow":"false"}